    1     Delete var all    2     Compress all    3     Goto 100   50   Rem ** Port of C64 ADVENTURE64 300 point abridged version **   51   Rem ** Monty McGraw, Feb 1, 2021, requires 4041 with tape or 4041DDU    **   52   Rem    *** New Variables   53   Rem    N$ = Tek4907 floppy disk filename with Scratchlib path   54   Rem    S$ = S$() object string array /w END OF STRING PTRs IN S9()   55   Rem    I$ = I$() object string array /w END OF STRING PTRs IN I9()   56   Rem    X  = replacement for I as program uses I as a STRING array   57   Rem    V$ = replacement for IV$ array with V9() string end pointers   58   Rem    G$ = replacement for E$ (Tek BASIC only has 1 ltr strings   59   Rem    H$ = replacement for F2$   60   Rem    *** %(integer) Variable Substitutions ***   62   Rem        D%()= D0()   63   Rem        D%  = D8   64   Rem        I%()= I0()   65   Rem        I%  = I8   66   Rem        K%()= K0()   68   Rem        M%()= M0()   70   Rem        S%()= S0()   72   Rem        T%()= T0()   74   Rem         K()= K5() to avoid collision with K simple variable   75   Rem          M0= M1   AS M0() IS DEFINED   80   Rem  function replaces CALL BITTES V1=value, X is bit number   85   Rem  DEF fnb(x)=int(v1/2^x-int(v1/2^x)+0.5) !4050 series only, convert to FUNCTION   90   Rem ON EOF(6) THEN GOTO 95      !4050 series only   92     E$=""   93     F1=0   94     F2=0   95     F3=10   96     Goto 4480  100     Init  101     REM Open #10:"COMM0(bau=9600,fla=bid,edit=ras):"  102     REM Rcall "GINIT",10,4014,1  103     REM PAGE  104   Rem initialize Tek 4050 RND number generator  105     B=rnd(-1)  106     B=rnd(1)  107     Dim n$ to 40  108   Rem    N$=filename so insert path: N$=REP$("@SCRATCHLIB/",1,0)  109   Rem    OPEN N$;1,"F",Z$          : Z$ is returned status   110   Rem DATA  162,6,32,198,255,32,228,255,201,35,208,249,76,204,255  120   Rem FOR J=900 TO 914: READ X: POKE J, X: NEXT J  122     K1=131  123     Long k5(k1),B  124     Integer k0(k1),d0(5),f1,f2,f3,f8,i,j,k,p,j1,i1,v1,x  125     Data 0,0,"",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0  126     Data 0,0,0,"",0,0,"",0,0,0,0,0  127     Integer t,d2,f3,l,f9,b2,l2,c,m1,r0,b0,x0,L3,L4,L7,L8,L9,a  128     Read t,d2,f$,f3,l,f9,b2,l2,c,m1,r0,b0,x0,L3,L4,L7,L8,L9,a,b  129     Integer b1,b3,b4,d,d8,g,h,i8,j2,j3,j4,k6,k7,k8,k9,p1,r0,v,z,z8  130     Read b1,b3,b4,d,d8,g,h,i8,j2,j3,j4,k6,k7,k8,k$,L4,L9,l$,p1,r0,v,z,z8  131     K8=0  139     D0=0  140     S1=114  142     Integer s0(s1+1),t0(s1),s9(s1),m0(s1,10)  143     Dim s$ to 4285,v$ to 505  150     I1=38  155     Integer i0(i1),i9(i1),v9(i1)  156     Dim i$ to 1580,M$ TO 72  162     Print "Welcome ";  163   Rem CALL "MOUNT",1,A$ !4050 series only  164   Rem CALL "UNIT",1     !4050 series only  170     Open #1:"advkeys"  172     For j=1 to k1  174       Input #1:k0(j),k5(j)  176       Next j  178     Close 1  180     Print "to ";  190     Open #1:"advshor"  191     S$=""  192     For j=1 to s1  193       Input #1:m$,t0(j)  194       S$=s$&m$  195       X=len(s$)  196       S9(j)=x  197       Next j  198     Close 1  200     Print "Adventure";  210     Open #1:"advmap"  212     For j=1 to s1  213       K=1  214       Input #1:m0(j,k),m0(j,k+1),m0(j,k+2),m0(j,k+3),m0(j,k+4)  215       K=6  216       Input #1:m0(j,k),m0(j,k+1),m0(j,k+2),m0(j,k+3),m0(j,k+4)  218       Next j  219     Close 1  220     Print "!"  225     I$=""  230     Open #1:"advitm"  232     For j=1 to i1  233       Input #1:m$  234       I$=i$&m$  235       X=len(i$)  236       I9(j)=x  237       Next j  240     For j=1 to i1  242       Input #1:i0(j)  244       Next j  245     V$=""  250     For j=1 to i1  253       Input #1:m$  254       V$=v$&m$  255       I=len(v$)  256       V9(j)=i  257       Next j  258     Close 1  260     L1=6  262     L5=1.0E+6  264     L6=149  266     B0=1  267     S0=0  268     S0(0+1)=1  270     Z$="y"  272     Print "Do you want instructions? ";  274     Input z$  280     F1=0  290     If z$<>"Y" then goto 330  300     REM PAGE  302     Gosub 4460  310     F1=f1+1  312     If f1<>4 then goto 320  314     Close 6  316     Goto 327  318     Z$="y"  320     Print "More instructions? ";  321     Input z$  322     Goto 290  323     Print "  SAVE  - save your current position;"  324     Print "  LOAD  - load in a previously"  325     Print "          saved position."  326     Z$="y"  327     Print "Ready to start? ";  328     Input z$  329     If z$<>"Y" then goto 270  330     J1=0  340     REM PAGE  342     K9=18  344     Gosub 4260  345     V1=t0(l1)  347     U=fnb(v1,1)  348     If u>0 or (i=-1 and l=1) then goto 360  350     F1=13  352     Goto 2930  360     If s0(l1+1)=5 then goto 380  370     If s0(l1+1)>0 or f9>j1 then goto 390  380     U=fnb(v1,7)  381     If u<>0 then goto 390  382     F1=l1+200  384     S0(l1+1)=0  386     Gosub 4460  388     Goto 400  389   Rem extract and print S$(L1)  390     X0=1  393     X1=s9(l1)  394     If l1=1 then goto 396  395     X0=s9(l1-1)+1  396     M$=seg$(s$,x0,x1-x0+1)  399     Print m$  400     S0(l1+1)=s0(l1+1)+1  405     Gosub 3740  410     If i0(27)<>-1 then goto 420  412     F1=50  414     Gosub 4460  420     If m1=0 then goto 4410  430     Gosub 3570  431     Print  432     Print "Action: ";  433     U$=chr$(t0(l1))  434     Input a$  435     M$=seg$(a$,1,4)  436     If m$="LOAD" then goto 5000  438     If m$="SAVE" then goto 6000  439     If m$="HELP" then goto 270  440     A=len(a$)  442       For j=1 to a  444         M$=seg$(a$,j,1)  445         If m$<>" " then exit to 450  446         Next j  450     K9=0  452     J1=j  454     If j>a then goto 420  461       For j=j1 to a  463         M$=seg$(a$,j,1)  464         If m$=" " then exit to 470  465         Next j  470     J2=j-j1  472     If j>a then goto 480  474       For j=j to a  475         M$=seg$(a$,j,1)  476         If m$<>" " then exit to 480  478         Next j  480     If j<=a then goto 490  482     J3=j1  484     J4=j2  486     Goto 510  490     J3=j  492       For j=j3 to a  493         M$=seg$(a$,j,1)  494         If m$=" " then exit to 500  496         Next j  500     J4=j-j3  510     L$=seg$(a$,j3,j4)  512     B=0  514       For j=1 to 5  515         M$=seg$(l$,j,1)  516         B=b*26+asc(m$)-64  520         If j>=len(l$) then exit to 530  525         Next j  530       For j=1 to 77  535         If b=k5(j) then exit to 550  540         Next j  542     If l$<>"it" and l$<>"them" then goto 550  544     K9=k8  546     Goto 560  550     K9=k0(j)  552     K7=j  554     If k9<=199 then goto 560  556     K9=0  560     K8=k9  562     If k9<=99 or k9=154 then goto 570  564     K=k9  566     Goto 750  570     K$=seg$(a$,j1,j2)  571     B=0  573       For j=1 to 5  575         M$=seg$(k$,j,1)  576         B=b*26+asc(m$)-64  580         If j>=len(k$) then exit to 590  585         Next j  590       For j=51 to k1  595         If b=k5(j) then exit to 650  600         Next j  602     If k9<>0 then goto 610  604     Print "I don't know that word."  606     Goto 420  610     If k6<=0 then goto 620  612     K=k6  614     Goto 730  620     Gosub 4260  622     If i>0 then goto 420  630     J=k7  632     If k9<=0 then goto 640  634     Print "What do you want to do with the ";l$;"?"  636     Goto 420  640     Print "I don't know how to do that."  645     Goto 420  650     K=k0(j)  652     K6=0  654     If k9>0 or k<299 then goto 730  660     If k<>304 then goto 670  662     J1=1  664     J2=34  666     Goto 690  670     If k<>307 then goto 680  672     J1=35  674     J2=38  676     Goto 690  680     K6=k  682     Print k$;" what?"  684     Goto 420  690       For j=j1 to j2  695         If i0(j)<>l1 then goto 720  700         If k9>0 then exit to 680  710         K9=j  720         Next j  725     If k9=0 then goto 680  730     If k9<>39 then goto 740  732     F1=101  734     Goto 2930  740     If k9<=0 or k9>=35 then goto 750  742     Gosub 4260  744     If i>=0 then goto 1820  750     M1=0  755     If k>99 and k<110 then goto 860  760     If k>=200 or l5>=50 then goto 765  762     Print "Please exit by main entrance only."  764     Goto 420  765     If k9<>32 or l1<=112 then goto 770  767     F1=128  769     Goto 2930  770     Goto k-149 of 1660,1690,1710,1900,1920,1960,3510,840,3410  780     Goto k-199 of 2140,1830,4570,2250,2290,2310,2970,3030,3420,3540  790     Goto k-209 of 3550,3560,4670,1650,420,2000,2030,3260,3310,3330  800     Goto k-219 of 3380,3390  810     Goto k-299 of 1980,2060,2190,2230,2340,2500,2610,2740,2850,3120  820     Goto k-309 of 3220,3460,3480,1740,1770  840       For j=1 to 10  842         If l2<>m0(l1,j) then goto 850  844         L9=l2  846         Exit to 900  850         Next j  852     Print "I've forgotten which way I came."  854     Goto 420  860     M1=1  865     D=k-99  870     If l>0 then goto 890  880     K9=18  882     Gosub 4260  883     U=fnb(v1,2)  884     U1=fnb(v1,1)  889     If u=1 and u1=0 then goto 2040  890     L9=m0(l1,d)  892     If l9<>0 then goto 900  894     Print "You can't go that way."  896     Goto 420  900     If i0(37)<>l1 or l9=l2 then goto 910  902     Print "You can't get by the snake"  904     Goto 420  910     If i0(36)<>l1 or l9=l2 then goto 920  912     F1=53  914     Goto 2930  920     If abs(l1-l9)>1 then goto 1010  930     If (l1+l9)<>21 or g<>0 then goto 940  932     F1=100  934     Goto 2930  940     If (l1+l9)<>39 or b2<>0 then goto 950  942     F1=102  944     Goto 2930  950     If l1+l9<>115 then goto 980  960       For j=1 to i1  962         If j<>10 and i0(j)=-1 then exit to 970  964         Next j  966     Goto 980  970     F1=120  975     Goto 2930  980     If l1+l9=121 then goto 1200  990     If (l1+l9)<>147 or d2<>0 then goto 1000  992     F1=130  994     Goto 2930 1000     If l1<>17 or i0(1)<>-1 then goto 1010 1002     F1=103 1004     Goto 2930 1010     If l1<>40 or l9<>37 then goto 1040 1020     F1=57 1022     J=25 1024     If i0(25)=-1 then goto 1030 1026     J=31 1028     F1=58 1030     If i0(j)=-1 then goto 2930 1040     If l9<>255 then goto 1050 1045     Gosub 1260 1050     L2=l1 1052     L1=l9 1054     If l1<10 then goto 1090 1060     L5=l5-1 1065     If l5<>50 then goto 1080 1070     For j=17 to 23 step 2 1071       I0(j)=0 1072       Next j 1073     I0(16)=0 1074     G=0 1075     B0=0 1076     B2=0 1077     F1=55 1078     Gosub 4460 1080     If l5<>0 then goto 1090 1082     F1=56 1084     Gosub 4460 1085     For j=16 to 21 1086       I0(j)=0 1087       Next j 1088     L1=113 1089     Goto 330 1090     L6=l6-l 1095     If l6>75 or i0(33)>-1 then goto 1110 1100     L6=1.0E+9 1102     I0(33)=0 1104     I0(34)=-1 1106     F1=11 1108     Gosub 4460 1110     If l6>=0 then goto 1120 1112     F1=104 1114     Goto 4660 1120     If l6<>75 then goto 1130 1122     F1=10 1124     Gosub 4460 1125     U=fnb(v1,6) 1130     If u>0 then goto 330 1140     For j=0 to 4 1142       D8=d0(j+1) 1144       If d8<0 or d8=l1 then goto 1180 1150       If d8<>l2 then goto 1160 1152       If l1<=17 or (l1>=58 and l1<=69) then goto 1160 1154       D8=l1 1156       Goto 1170 1160       D8=int(rnd(1)*84+17) 1162       If d8<=57 then goto 1170 1164       D8=d8+12 1170       D0(j+1)=d8 1180       Next j 1190     Goto 330 1200     If b3<>1 then goto 1210 1202     D=0 1204     Goto 890 1210     If t<>1 or i0(35)<>l1 then goto 1230 1212     T=0 1214     F1=110 1216     Goto 2930 1230     F1=105 1235     If t=0 then goto 2930 1240     If i0(27)<>-1 then goto 1250 1242     B3=1 1244     S0(66+1)=1 1246     F1=19 1247     Gosub 4460 1248     Goto 4590 1250     Goto 1000 1260     If l1=44 then goto 1290 1270     If d=7 or rnd(1)>0.1 then goto 1350 1280     L9=38 1285     Goto 1370 1290     If rnd(1)<0.5 then goto 1350 1300     L9=33 1302     J=rnd(1) 1304     If j<0.2 then goto 1370 1310     L9=37 1315     If j<0.4 then goto 1370 1320     L9=45 1325     If j<0.6 then goto 1370 1330     L9=92 1335     If j<0.8 then goto 1370 1340     L9=76 1345     Goto 1370 1350     Print "You have crawled thru some little holes"; 1352     L9=l1 1360     Print " and ended up in the main passage." 1370     Return 1380     K=b4 1390     If i0(26)<>39 then goto 1400 1395     K=k+1 1400     J2=-2 1402     If d0(4+1)<0 or i0(15)<=0 then goto 1410 1404     J2=i0(15) 1410     V=10 1412     For j=1 to 15 1414       J1=i0(j) 1420       If j1<>-1 then goto 1430 1422       K=k+v/2 1424       Goto 1460 1430       If j1<>7 then goto 1440 1432       K=k+v 1434       Goto 1450 1440       If j1<>j2 then goto 1450 1445       K=k+int(v/4) 1450       If s0(j1+1)<=0 then goto 1460 1455       K=k+1 1460       If j<>5 then goto 1470 1465       V=20 1470       Next j 1480     For j=0 to 3 1482       If d0(j+1)>=0 then goto 1490 1484       K=k+6 1490       Next j 1500     K=k-r0*3-h+(l1>10)*2 1510     J1=k 1512     B$="a beginning" 1514     K=k-20 1516     If k<0 then goto 1560 1520     B$="a novice" 1522     K=k-30 1524     If k<0 then goto 1560 1530     B$="a seasoned" 1532     K=k-50 1534     If k<0 then goto 1560 1540     B$="an advanced" 1542     K=k-80 1544     If k<0 then goto 1560 1550     B$="an expert" 1560     Print "Your score is ";j1;" out of a possible "; 1570     Print "300, which rates you as" 1580     Print b$;" adventurer." 1590     If k<0 then goto 1620 1600     If j1<300 then goto 1610 1605     Print "Congratulations on a perfect score!" 1610     Goto 1640 1620     Print "To achieve the next higher rating, you "; 1630     Print "will need ";-k;" more points." 1640     Return 1650     Gosub 1380 1655     Goto 420 1660     If l1<>7 and l1<>26 then goto 1680 1670     L9=33-l1 1675     Goto 1050 1680     Print "Nothing happens." 1685     Goto 420 1690     If l1<>7 and l1<>13 then goto 1680 1700     L9=20-l1 1705     Goto 1050 1710     If l1<>26 and l1<>58 then goto 1680 1720     If i0(10)<>-1 then goto 1730 1725     I0(10)=58 1730     L9=84-l1 1735     Goto 1050 1740     F1=106 1745     If k9=26 then goto 2930 1750     F1=107 1755     If k9<>31 or l1<113 then goto 2930 1760     F1=82 1762     Gosub 4460 1764     Gosub 3710 1766     Goto 420 1770     F1=108 1775     If k9<>41 then goto 2930 1780     F1=109 1785     If l1=80 then goto 2930 1790     If l1<113 then goto 1820 1800     F1=80 1805     Gosub 4460 1810     F1=69 1815     Goto 4660 1820     Print "I see no ";l$;" here." 1825     Goto 420 1830     U=fnb(v1,5) 1831     If k9=16 and u>0 then goto 2260 1840     D=0 1842     If l1=19 then goto 1850 1844     D=7 1850     If l1=20 then goto 1860 1855     D=3 1860     If l1=60 then goto 1870 1865     D=2 1870     If l1=61 then goto 1880 1875     D=6 1880     Goto 890 1890     Goto 1680 1900     If l1>10 then goto 1680 1910     L9=7 1915     Goto 1050 1920     If l1<5 or l1>9 then goto 1940 1930     L9=10 1935     Goto 1050 1940     If l1<12 or l1>16 then goto 1680 1950     L9=11 1955     Goto 1050 1960     If l1<25 or l1>32 then goto 1680 1970     L9=26 1975     Goto 1050 1980     If k9<>18 then goto 1990 1982     F1=17 1984     Goto 2930 1990     Print "Peculiar.  "; 1995     Goto 1680 2000     If l1=50 then goto 2010 2002     D=9 2004     Goto 890 2010     D=0 2015     If p1<>2 then goto 890 2020     L9=70 2025     Goto 920 2030     U=fnb(v1,2) 2031     If u=0 then goto 1680 2040     F1=18 2042     Gosub 4460 2044     Goto 4590 2050     If i0(21)<>l1 or i0(k9)<>l1 then goto 2060 2052     I0(21)=-1 2054     I0(k9)=-1 2056     Goto 2490 2060     If i0(21)=-1 then goto 2070 2062     B$="bottle" 2064     Goto 2110 2070     If k9<>6 then goto 2080 2072     F1=52 2074     Goto 2930 2080     U=fnb(v1,5) 2081     If u=0 then goto 2090 2082     B0=1 2084     I0(16)=-1 2086     I0(17)=0 2088     Goto 2130 2090     If l1<>49 then goto 2100 2092     B0=2 2094     I0(17)=-1 2096     I0(16)=0 2098     Goto 2130 2100     Goto 2120 2110     Print "You have no ";b$ 2112     Goto 420 2120     Print "Nothing to fill here." 2122     Goto 420 2130     Print "The bottle is filled." 2132     Goto 420 2140     If i0(21)<>-1 then goto 2060 2150     If l1=50 and i0(16)<0 then goto 2990 2160     Print "The bottle is empty." 2170     If i0(16)+i0(17)<>-1 then goto 2180 2172     F1=71 2174     Gosub 4460 2180     B0=0 2182     I0(17)=0 2184     I0(16)=0 2186     Goto 420 2190     If k9<>18 then goto 2220 2200     L=1 2201     U=fnb(v1,1) 2202     If u=0 then goto 330 2210     Goto 2490 2220     Print "I don't understand." 2222     Goto 420 2230     If k9<>18 then goto 2220 2240     L=0 2242     Goto 2490 2250     U=fnb(v1,5) 2251     If k9<>16 or u=0 then goto 2270 2260     F1=71 2262     Goto 2930 2270     If l1<>6 and l1<>68 then goto 2275 2271     D=3 2272     Goto 890 2275     If l1<>10 then goto 2280 2276     D=10 2277     Goto 890 2280     Goto 1680 2290     If l1<>7 and l1<>69 then goto 2300 2292     D=7 2294     Goto 890 2300     Goto 1680 2310       For j=1 to i1 2312         If i0(j)<=-1 then exit to 2320 2314         Next j 2316     Print "You are carrying nothing." 2318     Goto 420 2320     J1=j 2322     Print "You have: " 2324     For j=i1 to j1 step -1 2325       If i0(j)<>-1 or j=27 then goto 2338 2326       X0=1 2328       X1=v9(j) 2330       If j=1 then goto 2334 2332       X0=v9(j-1)+1 2334       M$=seg$(v$,x0,x1-x0+1) 2336       Print m$ 2338       Next j 2339     Goto 420 2340     If k9=16 or k9=17 then goto 2050 2350     Z8=0 2352     For j=1 to i1 2354       If i0(j)<>-1 then goto 2360 2356       Z8=z8+1 2360       Next j 2362     If z8<7 or k9=27 then goto 2380 2370     Print "You're carrying too much." 2372     Goto 420 2380     F1=44 2385     If k9=14 and i0(36)>0 then goto 2930 2390     F1=38 2395     If (k9=12 or k9=27 or k9=28) and b1=0 and i0(27)=l1 then goto 2930 2400     F1=116 2405     If (k9=12 or k9=27) and c=0 then goto 2930 2410     If k9<>42 then goto 2420 2412     If l1<>50 and l1<=112 then goto 2420 2414     F1=76 2416     Goto 2930 2420     If k9<>32 or i0(23)<>-1 then goto 2430 2422     F1=20 2424     Goto 2930 2430     If k9<>32 or i0(22)<0 then goto 2450 2440     F1=111 2445     Goto 2930 2450     If k9<=34 then goto 2460 2452     Print "You must be joking!" 2454     Goto 420 2460     I0(k9)=-1 2470     If k9<>21 or b0<=0 then goto 2480 2475     I0(b0+15)=-1 2480     If k9<>31 or l1<>113 then goto 2490 2482     Print "Ok." 2484     F1=81 2486     Goto 2930 2490     Print "Ok." 2495     Goto 420 2500     If k9=16 or k9=17 then goto 2140 2505     If k9>34 then goto 2220 2510     I0(k9)=l1 2512     If k9<>21 or b0<=0 then goto 2520 2514     I0(15+b0)=l1 2520     If l1<=112 then goto 2530 2522     Gosub 4340 2524     If i>=0 then goto 2530 2526     I0(k9)=0 2530     If k9<>16 and k9<>17 then goto 2540 2532     B0=0 2534     I0(k9)=0 2540     If k9<>22 or i0(32)<>-1 then goto 2550 2545     I0(32)=l1 2550     If k9<>4 or l1<>100 then goto 2560 2552     I0(k9)=0 2554     I0(33)=l1 2556     Goto 2730 2560     If k9<>6 then goto 2580 2570     If i0(29)=l1 then goto 2580 2572     F1=14 2574     Gosub 4460 2576     I0(k9)=0 2578     I0(30)=l1 2580     If k9=32 then goto 3120 2590     If k9<>27 or t>0 or i0(35)<>l1 then goto 2490 2600     T=2 2602     F1=31 2604     Goto 2930 2610     If k9>15 or i0(35)<>l1 then goto 2630 2620     I0(35)=121-l1 2622     I0(k9)=0 2624     T=1 2626     F1=54 2628     Goto 2930 2630     If k9=20 and i0(27)=l1 then goto 2960 2640     If k9<>28 then goto 2500 2650     If i0(35)<>l1 then goto 2660 2652     F1=16 2654     Goto 2930 2660     If i0(27)<>l1 or b1<>0 then goto 2670 2662     F1=77 2664     Goto 2930 2670       For j=0 to 3 2672         If d0(j+1)=l1 then exit to 2680 2674         Next j 2676     Goto 2500 2680     If rnd(1)>=0.5 then goto 2690 2682     Print "Missed!" 2684     Goto 2720 2690     Print "You killed a little dwarf" 2692     J2=j 2694       For j=1 to 3 2696         If d0(j+1)<0 then exit to 2710 2700         Next j 2702     F1=40 2704     Gosub 4460 2706     Goto 2711 2710     D0(j2+1)=-1 2720     I0(28)=l1 2725     J1=0 2730     Gosub 3890 2735     Goto 420 2740     If k9<i1 and i0(k9)<>l1 then goto 1820 2741     If k9<>i1 then goto 2745 2742     Gosub 4390 2744     If j1=0 then goto 1820 2745     If k9<>36 then goto 2790 2750     Print "With what?  Your bare hands: "; 2752     Input a$ 2760     If a$<>"AXE" then goto 2770 2762     F1=99 2764     Goto 2930 2770     M$=seg$(a$,1,1) 2771     If m$<>"Y" then goto 440 2780     I0(36)=0 2782     I0(38)=l1 2784     F1=42 2786     Goto 2930 2790     If k9<>35 then goto 2800 2792     F1=36 2794     Goto 2930 2800     If k9<>38 then goto 2810 2802     F1=51 2804     Goto 2930 2810     If k9<>32 then goto 2820 2812     I0(k9)=0 2814     S0(23+1)=1 2816     F1=64 2818     Goto 2930 2820     If k9<>27 then goto 2830 2822     F1=78+sign(b1) 2824     Goto 2930 2830     F1=113 2832     If k9<=31 then goto 2840 2834     F1=112 2840     Goto 2930 2850     If k9<>25 and k9<>31 then goto 2860 2852     F1=98 2854     Goto 2930 2860     If k9=27 then goto 2950 2870     F1=39 2872     If k9<=31 then goto 2880 2874     Goto k9-31 of 2890,2220,2220,2900,2910,2920,2930 2880     Goto 2220 2890     F1=21 2895     Goto 2930 2900     F1=37 2905     Goto 2930 2910     F1=35 2915     Goto 2930 2920     F1=35 2925     If i0(32)=-1 then goto 2940 2930     Gosub 4460 2935     Goto 420 2940     I0(32)=0 2942     F1=45 2944     Goto 2930 2950     B$="food" 2955     If i0(20)>-1 then goto 2110 2960     B1=1 2962     I0(20)=0 2964     F1=34 2966     Goto 2930 2970     B$="water" 2972     If l1<>50 then goto 620 2980     If i0(16)>-1 then goto 2110 2990     I0(16)=0 2992     B0=0 2994     If p1=3 then goto 1680 3000     P1=p1+1 3002     If p1<>1 then goto 3010 3004     F1=32 3006     Goto 2930 3010     If p1<>2 then goto 3020 3012     F1=33 3014     Goto 2930 3020     F1=72 3025     Goto 2930 3030     B$="keys" 3035     If l1=10 or l1=11 then goto 3050 3040     M$=seg$(k$,1,1) 3045     If l1<>69 or m$<>"U" then goto 1680 3050     If i0(19)>-1 then goto 2110 3060     If l1=69 then goto 3090 3070     G=0 3074     M$=seg$(k$,1,1) 3075     If m$<>"U" then goto 3080 3076     G=1 3080     Goto 2490 3090     If b1<>0 then goto 3100 3092     F1=38 3094     Goto 2930 3100     If c<>0 then goto 3110 3102     C=1 3104     B1=2 3110     F1=121 3115     Goto 2930 3120     If k9<>32 then goto 3180 3130       For j=36 to 37 3135         If i0(j)=l1 then exit to 3150 3140         Next j 3145     I0(k9)=l1 3146     Goto 2490 3150     If j=36 then goto 3170 3160     I0(j)=0 3162     I0(k9)=l1 3164     F1=22 3166     Goto 2930 3170     I0(k9)=0 3172     F1=23 3174     Goto 2930 3180     If k9<>27 then goto 2220 3190     If i0(k9)=-1 then goto 2500 3200     If c<>0 then goto 3210 3205     K$="u" 3206     Goto 3030 3210     Goto 2220 3220     If k9<>23 then goto 1680 3230     If abs(l1-19.5)>1 then goto 1680 3240     F1=114+b2 3242     B2=1-b2 3244     Goto 2930 3245     If l1=114 and i0(24)=113 then goto 3370 3260     If l1<>10 and l1<>11 and l1<>114 then goto 3270 3262     K$="u" 3264     Goto 3030 3270     F1=117 3275     If k9<>25 and k9<>31 then goto 2930 3280     F1=118 3282     If i0(9)>-1 then goto 2930 3290     F1=63 3295     If k9=31 then goto 2930 3300     I0(7)=43 3302     I0(25)=0 3304     I0(31)=l1 3306     F1=41 3308     Goto 2930 3310     If l1=10 or l1=11 then goto 3030 3320     Goto 1680 3330     F1=119 3335     If l1<113 then goto 2930 3340     F1=66 3350     F1=67 3355     If l1=113 and i0(24)=0 then goto 3370 3360     F1=68 3370     B4=(68-f1)*10+2 3375     Goto 4660 3380     Print "Watch it!" 3385     Goto 420 3390     If l1<>113 then goto 3400 3392     F1=46 3394     Gosub 4460 3396     Goto 1810 3400     Goto 1680 3410     F1=47 3415     Goto 2930 3420     B$="oil" 3421     If l1<>50 then goto 3425 3422     F1=129 3423     Goto 2930 3425     If l1<>73 then goto 620 3430     If d2=1 then goto 1680 3440     If b0<2 then goto 2110 3450     D2=1 3452     I0(17)=0 3454     B0=0 3456     F1=43 3458     Goto 2930 3460     F1=122 3465     If k9<>20 then goto 2930 3470     I0(k9)=0 3472     F1=123 3474     Goto 2930 3480     U=fnb(v1,5) 3481     If u=0 then goto 3490 3482     F1=65 3484     Goto 2930 3490     F1=124 3495     If k9<>16 then goto 2930 3500     I0(k9)=0 3502     F1=125 3504     Goto 2930 3510     If l1<>71 then goto 1680 3520     If i0(8)<>l1 and i0(8)<>-1 then goto 3530 3522     I0(8)=0 3524     F1=127 3526     Goto 2930 3530     I0(8)=l1 3532     I0(35)=60 3534     T=0 3536     F1=126 3538     Goto 2930 3540     F9=2 3542     F$="" 3544     Close 6 3546     Goto 420 3550     F9=0 3555     Goto 420 3560     F9=1 3565     Goto 420 3570     U=fnb(v1,3) 3571     If u=1 then goto 3580 3572     L4=0 3574     Goto 3730 3580     L4=l4+1 3590     F1=92 3595     If l1=15 and i0(32)=l1 and i0(23)=-1 and l4=4 then goto 3670 3600     F1=88 3602     If l1=39 and l4=8 then goto 3670 3610     F1=96 3615     If l1<9 and l4=12 and s0(13+1)=0 then goto 3670 3620     F1=86 3625     If l1>87 and l4=15 then goto 3670 3630     F1=84 3635     If l1=58 and l4=4 then goto 3670 3640     F1=94 3645     If l1=10 and l4=3 and i0(19)=7 then goto 3670 3650     F1=90 3655     If i0(37)=l1 and l4=3 and i0(32)>=0 then goto 3670 3660     Goto 3730 3670     Gosub 4460 3671     Print "> "; 3672     Input z$ 3674     M$=seg$(z$,1,1) 3675     If m$="Y" then goto 3680 3676     L4=0 3678     Goto 3730 3680     Print "I am prepared to give you a hint, but" 3690     Print "it will cost you ";(98-f1)/2;" points." 3700     Print "Do you want the hint? "; 3710     Input z$ 3711     M$=seg$(z$,1,1) 3712     If m$="Y" then goto 3720 3714     L4=0 3716     Goto 3730 3720     H=h+(98-f1)/2 3722     F1=f1+1 3724     Gosub 4460 3730     Return 3740     If l1<>100 then goto 3750 3741     F1=61 3742     Gosub 4460 3744     If i>0 then goto 3750 3746     F1=62 3748     Gosub 4460 3750     U=fnb(v1,4) 3751     If u=0 then goto 3860 3760     If i0(1)=-1 then goto 3790 3770     If l1<>16 then goto 3780 3775     Print "Rough stone steps lead down to the pit." 3780     If l1<>17 then goto 3790 3785     Print "Rough stone steps lead to the top of the dome." 3790     If b2=0 or l1<19 or l1>20 or l1+l2=39 then goto 3810 3800     Print "A crystal bridge spans the fissure." 3810     If l1<>73 or d2<>0 then goto 3820 3815     Print "A rusty door obstructs passage to north" 3820     If l1<60 or l1>61 or l1+l2=121 then goto 3860 3830     If b3<>1 then goto 3840 3832     F1=60 3834     Gosub 4460 3836     Goto 3860 3840     F1=30 3842     Gosub 4460 3850     If t<=0 then goto 3860 3855     Print "There is no sign of the troll." 3860     Gosub 4390 3865     If d0(0+1)<0 or j1=0 then goto 3890 3870     F1=12 3875     Gosub 4460 3880     I0(28)=l1 3882     For j=0 to 3 3884       D0(j+1)=j-1 3886       Next j 3890     For j=1 to i1 3895       If l1<>i0(j) then goto 3970 3900       If j<>27 then goto 3920 3910       If b1<>0 then goto 3920 3911       F1=131 3912       Gosub 4460 3914       Return 3920       If j=35 and t<>0 then goto 3970 3930       If j<>15 then goto 3940 3935       D0(5)=-1 3940       If j=12 and c=0 then goto 3970 3950       If j=21 and b0>0 then goto 3970 3952       X0=1 3954       X1=i9(j) 3956       If j=1 then goto 3960 3958       X0=i9(j-1)+1 3960       M$=seg$(i$,x0,x1-x0+1) 3962       Print m$ 3964       K8=j 3970       Next j 3980     If s0(40+1)=0 or i0(15)=0 or l5<99 then goto 4020 3990       For j=1 to 15 3992         J2=i0(j) 3994         If j2<1 then goto 4010 4000         If s0(j2+1)=0 then exit to 4020 4010         Next j 4015       L5=60 4020     If l1<10 or l1>11 then goto 4050 4030     If g<>0 then goto 4040 4035     Print "The grate is locked." 4040     If g<>1 then goto 4050 4045     Print "The grate is open." 4050     If l1<>26 or rnd(1)<=0.7 then goto 4060 4055     Print "A hollow voice says 'plugh'." 4060     If l1<>50 then goto 4080 4070     If p1>=3 then goto 4080 4072     F1=73+p1 4074     Gosub 4460 4080     If l1<47 or l1>49 or (l2>46 and l2<51) then goto 4110 4090     If p1<>1 and p1<>2 then goto 4110 4092     F1=132+p1 4094     Gosub 4460 4110     If i0(27)<>l1 then goto 4130 4120     If c<>0 then goto 4130 4122     F1=132 4124     Gosub 4460 4130     Gosub 4390 4135     If j1=0 then goto 4170 4140     If j1=1 then goto 4160 4150     Print "There are ";j1;" threatening dwarves here!" 4155     Goto 4170 4160     Print "There is a threatening dwarf here!" 4170     If d0(5)<>l1 then goto 4250 4180     J2=0 4182     For j=1 to 14 4184       If i0(j)<>-1 then goto 4190 4186       J2=j2+1 4190       Next j 4192     If j2>=2 or rnd(1)>=0.3 then goto 4200 4194     F1=70 4196     Gosub 4460 4200     If j2<2 then goto 4250 4210     F1=15 4215     Gosub 4460 4220     I8=i0(15) 4222     If i8<>0 then goto 4230 4224     I8=int(rnd(1)*10)+102 4226     I0(15)=i8 4230     For j=1 to 14 4232       If i0(j)<>-1 then goto 4240 4234       I0(j)=i8 4240       Next j 4242     D0(5)=i8 4250     Return 4260     I=0 4262     If k9>i1 then goto 4270 4264     I=i0(k9) 4266     If i=-1 then goto 4330 4270     If (k9<>23 and k9<>33) then goto 4280 4272     If i0(k9+1)<>-1 then goto 4280 4274     K9=k9+1 4276     I=-1 4278     Goto 4330 4280     If i<>l1 then goto 4290 4282     I=-1 4284     Goto 4330 4290     U$=chr$(t0(l1)) 4291     U=fnb(v1,5) 4292     If k9<>16 or u=0 then goto 4300 4293     I=-1 4300     If k9<>17 or l1<>49 then goto 4310 4305     I=-1 4310     If i<0 or l1<=112 then goto 4320 4312     Gosub 4340 4320     If (k9<>23 and k9<>33) or i<0 then goto 4330 4322     K9=k9+1 4324     Goto 4260 4330     Return 4340     I=0 4345     If l1=114 then goto 4370 4350     If k9<>18 and k9<>21 and k9<>23 and k9<>31 then goto 4360 4355     I=-1 4360     Return 4370     If k9<>22 and k9<>24 and k9<>29 and k9<>32 then goto 4380 4375     I=-1 4380     Return 4390     J1=0 4395     For j=0 to 3 4397       If d0(j+1)<>l1 then goto 4400 4398       J1=j1+1 4400       Next j 4405     Return 4410     Gosub 4390 4415     If j1=0 then goto 4450 4420     Print "A sharp knife is thrown at you!" 4430     If rnd(1)<=0.2*j1 then goto 4440 4432     Print "It missed!" 4434     Goto 4450 4440     Print "It got you!" 4442     Goto 4590 4450     Goto 430 4460     F8=int(f1/10) 4465     F2=f1-f8*10 4466     E$=str$(f8) 4470     E$="advf"&e$ 4480     If f$=e$ and f2<>f3 then goto 4500 4490     Close 6 4492     F$=e$ 4494     Open #6:f$ 4499     P=0 4500     F3=f2 4501     Input #6:z$ 4502     J=len(z$) 4503     If j<>1 then goto 4511 4504     K=asc(z$) 4505     If k>57 then goto 4530 4506     K=val(z$) 4507     If k<f2 then goto 4501 4508     If k<>f2 then goto 4532 4509     P=1 4510     Goto 4501 4511     If p=0 then goto 4501 4512     Print z$ 4513     Goto 4501 4530     If p=0 then goto 4501 4532     P=0 4540     Return 4570     J1=1 4572     S0(l1+1)=0 4574     Goto 340 4590     For j=1 to i1 4592       If i0(j)<>-1 then goto 4600 4594       I0(j)=l1 4600       Next j 4605     If l6<25 or l5<51 then goto 4650 4610     R0=r0+2 4612     F1=r0+22 4614     Gosub 4460 4616     Input z$ 4620     M$=seg$(z$,1,1) 4622     If m$<>"Y" then goto 4670 4630     F1=r0+23 4632     Gosub 4460 4634     If r0>5 then goto 4670 4640     L1=7 4642     I0(18)=6 4644     L=0 4646     Goto 330 4650     F1=59 4660     Gosub 4460 4670     Gosub 1380 4672     Close 6 4690     Goto 6910 5000     Print "Input file#(1 to 9) of saved game to LOAD: "; 5002     Input e$ 5006     E$="ADVPOS"&e$ 5008     Open #2:e$ 5030     For y=1 to 114 5032       Input #2:t0(y),s0(y+1) 5034       Next y 5040     For y=1 to 131 5042       Input #2:k0(y),k5(y) 5044       Next y 5050     For y=1 to 38 5052       Input #2:i0(y) 5054       Next y 5070     For y=1 to 4 5072       Input #2:d0(y+1) 5074       Next y 5080     Input #2:l1,l2,l3,l4,l5,l6,l7,l8,l9 5090     Input #2:a,a$,b,b1,b2,b3,b4,c,d 5100     Input #2:d2,d8,f1,f2,f3,f9,f$,e$,f8 5110     Input #2:g,h,i,i1,i8,j,j1,j2 5120     Input #2:j3,j4,k,k1,k6,k7,k8,k9,k$ 5130     Input #2:l,l1,l2,l4,l5,l6,l9,l$ 5140     Input #2:m1,p1,r0,s1,t,v,x 5150     Input #2:z,z8,z$ 5900     Close 2 5905     Goto 420 6000     Print "Input file#(1 to 9) for SAVE game: "; 6002     Input e$ 6006     E$="ADVPOS"&e$ 6010     Open #2:e$&"(ope=repl,cli=yes,for=asc)" 6030     For y=1 to 114 6032       Print #2:t0(y) 6033       Print #2:s0(y+1) 6034       Next y 6040     For y=1 to 131 6042       Print #2:k0(y) 6043       Print #2:k5(y) 6044       Next y 6050     For y=1 to 38 6052       Print #2:i0(y) 6054       Next y 6070     For y=1 to 4 6072       Print #2:d0(y+1) 6074       Next y 6080     Print #2:l1 6081     Print #2:l2 6082     Print #2:l3 6083     Print #2:l4 6084     Print #2:l5 6085     Print #2:l6 6086     Print #2:l7 6087     Print #2:l8 6088     Print #2:l9 6090     Print #2:a 6091     Print #2:a$ 6092     Print #2:b 6093     Print #2:b1 6094     Print #2:b2 6095     Print #2:b3 6096     Print #2:b4 6097     Print #2:c 6098     Print #2:d 6100     Print #2:d2 6101     Print #2:d8 6102     Print #2:f1 6103     Print #2:f2 6104     Print #2:f3 6105     Print #2:f9 6106     Print #2:F$ 6107     Print #2:e$ 6108     Print #2:f8 6110     Print #2:g 6111     Print #2:h 6112     Print #2:i 6113     Print #2:i1 6114     Print #2:i8 6115     Print #2:j 6116     Print #2:j1 6117     Print #2:j2 6120     Print #2:j3 6121     Print #2:j4 6122     Print #2:k 6123     Print #2:k1 6124     Print #2:k6 6125     Print #2:k7 6126     Print #2:k8 6127     Print #2:k9 6128     Print #2:k$ 6130     Print #2:l 6131     Print #2:l1 6132     Print #2:l2 6133     Print #2:l4 6134     Print #2:l5 6135     Print #2:l6 6136     Print #2:l9 6137     Print #2:l$ 6140     Print #2:m1 6141     Print #2:p1 6142     Print #2:r0 6143     Print #2:s1 6144     Print #2:t 6145     Print #2:v 6146     Print #2:x 6150     Print #2:z 6151     Print #2:z8 6152     Print #2:z$ 6900     Close 2 6902     Print "Saved Ok." 6904     Goto 420 6910     End 7000 Function fnb(n,o) 7005     Integer n,o 7010     Fnb=int(n/2^o-int(n/2^o)+0.5) 7020     Return 7030     End